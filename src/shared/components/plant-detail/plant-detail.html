<div class="plant-detail-container">
  <!-- Indicateur de chargement -->
  @if (loading) {
  <div class="loading">
    <p>Chargement des donnÃ©es...</p>
  </div>
  }

  <!-- Message d'erreur -->
  @if (error) {
  <div class="error-message">
    <p>âŒ {{ error }}</p>
    <button class="btn-retry" (click)="refresh()">RÃ©essayer</button>
  </div>
  }

  <!-- Contenu principal (si pas d'erreur) -->
  @if (plant && !loading) {
  <!-- En-tÃªte avec infos de la plante -->
  <div class="plant-header">
    <button class="btn-back" (click)="onClose()">
      <i class="pi pi-arrow-left"></i> Retour Ã  la liste
    </button>

    <div class="plant-info">
      <img
        [src]="plant.imageUrl || 'assets/placeholder-plant.jpg'"
        alt="{{ plant.name }}"
        class="plant-image"
      />
      <div class="plant-meta">
        <h1>{{ plant.name }}</h1>
        <p class="species">{{ plant.species }}</p>
        <p class="plant-id">ID: {{ plant.id }}</p>
      </div>
    </div>
  </div>

  @if (plant.lastMeasurement) {
  <!-- DerniÃ¨re mesure (vue d'ensemble) -->
  <div class="current-status">
    <h2>Ã‰tat actuel</h2>
    <div class="status-grid">
      <div class="status-card">
        <span class="icon">ğŸ’§</span>
        <div class="status-info">
          <p class="label">HumiditÃ© du sol</p>
          <p class="value">
            {{ plant.lastMeasurement.soilMoisture.value
            }}{{ plant.lastMeasurement.soilMoisture.unit }}
          </p>
          <span class="badge">
            {{ plant.lastMeasurement.soilMoisture.status }}
          </span>
        </div>
      </div>

      <div class="status-card">
        <span class="icon">ğŸŒ¡ï¸</span>
        <div class="status-info">
          <p class="label">TempÃ©rature</p>
          <p class="value">
            {{ plant.lastMeasurement.temperature.value
            }}{{ plant.lastMeasurement.temperature.unit }}
          </p>
        </div>
      </div>

      <div class="status-card">
        <span class="icon">ğŸ’¨</span>
        <div class="status-info">
          <p class="label">HumiditÃ© air</p>
          <p class="value">
            {{ plant.lastMeasurement.humidity.value
            }}{{ plant.lastMeasurement.humidity.unit }}
          </p>
        </div>
      </div>

      <div class="status-card">
        <span class="icon">â˜€ï¸</span>
        <div class="status-info">
          <p class="label">LuminositÃ©</p>
          <p class="value">
            {{ plant.lastMeasurement.light.value }}
            {{ plant.lastMeasurement.light.unit }}
          </p>
          <span class="badge">
            {{ plant.lastMeasurement.light.status }}
          </span>
        </div>
      </div>

      <div class="status-card">
        <span class="icon">ğŸ’¦</span>
        <div class="status-info">
          <p class="label">Pompe</p>
          <p class="value">
            {{
              plant.lastMeasurement.waterPump.isActive ? "Active" : "Inactive"
            }}
          </p>
          <span class="badge">
            Mode
            {{ plant.lastMeasurement.waterPump.autoMode ? "Auto" : "Manuel" }}
          </span>
        </div>
      </div>
    </div>
  </div>
  }

  <!-- Historique des mesures -->
  <div class="measurement-history">
    <h2>Historique des mesures</h2>

    @if (measurements.length > 0) {
    <div class="history-list">
      @for (measurement of measurements; track measurement.timestamp) {
      <div class="measurement-card">
        <div class="measurement-header">
          <h3>{{ formatDate(measurement.timestamp) }}</h3>
        </div>

        <div class="measurement-grid">
          <div class="measurement-item">
            <span class="label">ğŸ’§ HumiditÃ© sol</span>
            <span class="value">
              {{ measurement.soilMoisture.value
              }}{{ measurement.soilMoisture.unit }}
              <span class="badge small">
                {{ measurement.soilMoisture.status }}
              </span>
            </span>
          </div>

          <div class="measurement-item">
            <span class="label">ğŸŒ¡ï¸ TempÃ©rature</span>
            <span class="value"
              >{{ measurement.temperature.value
              }}{{ measurement.temperature.unit }}</span
            >
          </div>

          <div class="measurement-item">
            <span class="label">ğŸ’¨ HumiditÃ© air</span>
            <span class="value"
              >{{ measurement.humidity.value
              }}{{ measurement.humidity.unit }}</span
            >
          </div>

          <div class="measurement-item">
            <span class="label">â˜€ï¸ LuminositÃ©</span>
            <span class="value">
              {{ measurement.light.value }} {{ measurement.light.unit }}
              <span class="badge small">
                {{ measurement.light.status }}
              </span>
            </span>
          </div>

          <div class="measurement-item">
            <span class="label">ğŸ’¦ Pompe</span>
            <span class="value">
              {{ measurement.waterPump.isActive ? "âœ… Active" : "â­• Inactive" }}
              ({{ measurement.waterPump.autoMode ? "Auto" : "Manuel" }})
            </span>
          </div>
        </div>
      </div>
      }
    </div>
    } @else {
    <p class="no-data">Aucune mesure disponible pour cette plante</p>
    }
  </div>
  } @else {
  <div class="error-message">
    <p>âŒ Plante non trouvÃ©e</p>
    <button class="btn-back" (click)="onClose()">Retour Ã  la liste</button>
  </div>
  }
</div>
